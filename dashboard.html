
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroShield - Dashboard</title>

    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Base styles and font */
        body {
            font-family: 'Orbitron', sans-serif;
            background-color: #000000;
            color: #00ffcc; /* Neon Teal */
            /* Add padding top equal to nav height to prevent content overlap */
            padding-top: 70px; /* Adjust based on final nav height */
            min-height: 100vh;
        }

        /* Matrix Background Styling */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Behind everything */
            overflow: hidden;
        }
        .matrix-canvas {
            display: block;
        }

        /* Neon Text Effect */
        .neon-text {
            color: #ffffff;
            text-shadow:
                0 0 5px rgba(0, 255, 204, 0.8),
                0 0 10px rgba(0, 255, 204, 0.8),
                0 0 15px rgba(0, 255, 204, 0.7);
                /* Removed green shadow for cleaner look */
        }

        /* Navigation Bar Styling */
        .navbar {
             background-color: rgba(0, 5, 5, 0.8); /* Slightly darker nav */
             border-bottom: 1px solid #007a7a; /* Darker cyan border */
             backdrop-filter: blur(8px);
             box-shadow: 0 4px 20px rgba(0, 255, 204, 0.1); /* More pronounced shadow */
             z-index: 50; /* Ensure nav is above content */
        }

        /* Navigation Link Styling */
        .nav-link {
            color: #00ffcc;
            font-size: 0.9rem; /* Slightly smaller nav links */
            font-weight: 500; /* Medium weight */
            padding: 0.6rem 1rem; /* Adjust padding */
            border-radius: 4px;
            border: 1px solid transparent;
            transition: all 0.25s ease-in-out;
            position: relative; /* For pseudo-elements if needed */
            text-transform: uppercase; /* Uppercase links */
            letter-spacing: 0.05em;
        }
        .nav-link:hover {
            color: #ffffff;
            background-color: rgba(0, 255, 204, 0.15);
            border-color: rgba(0, 255, 204, 0.3);
            text-shadow: 0 0 8px rgba(0, 255, 204, 0.5);
        }
        .nav-link.active { /* Style for the current page link */
            color: #000000; /* Black text on active */
            background-color: #00ffcc; /* Solid teal background */
            border-color: #00ffcc;
            font-weight: 700; /* Bold active link */
            text-shadow: none;
            box-shadow: 0 0 12px rgba(0, 255, 204, 0.6);
        }
         .nav-link-disabled {
             color: #007a7a; /* Dim color for disabled */
             cursor: not-allowed;
             opacity: 0.6;
         }
         .nav-link-disabled:hover { /* Prevent hover effects on disabled */
            background-color: transparent;
            border-color: transparent;
            text-shadow: none;
         }

        /* Logout Button */
         .logout-button {
             background-color: rgba(255, 77, 77, 0.2); /* Transparent red */
             border: 1px solid #ff4d4d;
             color: #ff9999; /* Lighter red text */
             font-size: 0.8rem;
             padding: 0.5rem 0.9rem;
             border-radius: 4px;
             font-weight: bold;
             transition: all 0.25s ease;
             text-transform: uppercase;
         }
          .logout-button:hover {
              background-color: #ff4d4d; /* Solid red on hover */
              color: #ffffff;
              box-shadow: 0 0 10px rgba(255, 77, 77, 0.7);
          }

        /* Dashboard Card Styling */
        .card {
            background-color: rgba(0, 20, 20, 0.75); /* Slightly darker card */
            border: 1px solid #005050;
            backdrop-filter: blur(4px);
            padding: 1.5rem;
            border-radius: 6px; /* Slightly less rounded */
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.1);
            margin-bottom: 1.5rem; /* Consistent spacing */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
         .card:hover {
             /* transform: translateY(-3px); */ /* Optional subtle lift */
             /* box-shadow: 0 4px 25px rgba(0, 255, 204, 0.18); */ /* Enhanced glow */
         }

        /* Live Stat Number Styling */
        .stat-number {
            font-size: 2.2rem; /* Slightly smaller stats */
            font-weight: 700; /* Bold */
            color: #ffffff;
            line-height: 1.2;
            text-shadow: 0 0 6px rgba(0, 255, 204, 0.6); /* Adjust glow */
            /* Add transition for smooth updates if needed */
            transition: color 0.3s ease;
        }
         .stat-label {
             font-size: 0.9rem;
             color: #80ffff; /* Lighter cyan for labels */
             margin-bottom: 0.5rem;
             text-transform: uppercase;
             letter-spacing: 0.05em;
         }

        /* Phishing List Item Styling */
        .list-item {
            background-color: rgba(0, 40, 40, 0.4); /* Darker list items */
            padding: 0.75rem 1rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            border-left: 4px solid #00ffcc; /* Accent border */
            font-size: 0.85rem; /* Smaller font for list */
            color: #cceeee; /* Lighter text color */
            transition: background-color 0.2s ease, border-color 0.2s ease;
            word-break: break-all; /* Prevent overflow */
        }
        .list-item:hover {
            background-color: rgba(0, 60, 60, 0.6);
            border-left-color: #ffffff;
            color: #ffffff;
        }
        .list-container {
            max-height: 320px; /* Adjusted max height */
            overflow-y: auto;
            /* Custom scrollbar styling (Webkit browsers) */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: #00ffcc rgba(0, 40, 40, 0.4); /* Firefox */
        }
        .list-container::-webkit-scrollbar {
            width: 6px;
        }
        .list-container::-webkit-scrollbar-track {
            background: rgba(0, 40, 40, 0.2);
            border-radius: 3px;
        }
        .list-container::-webkit-scrollbar-thumb {
            background-color: #00ffcc;
            border-radius: 3px;
            border: 1px solid rgba(0, 40, 40, 0.2);
        }
         .list-container::-webkit-scrollbar-thumb:hover {
             background-color: #ffffff;
         }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 320px; /* Explicit height for chart canvas container */
            width: 100%;
        }

    </style>
</head>
<body class="antialiased"> <div class="matrix-bg">
        <canvas id="matrixCanvas" class="matrix-canvas"></canvas>
    </div>

    <nav class="navbar fixed top-0 left-0 right-0">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16"> {/* Fixed height */}
                {/* Logo/Brand */}
                <div class="flex-shrink-0 flex items-center">
                    <a href="dashboard.html" class="text-2xl font-bold neon-text hover:opacity-80 transition-opacity duration-200">
                        NeuroShield
                    </a>
                </div>

                {/* Navigation Links */}
                <div class="hidden sm:ml-6 sm:flex sm:items-center sm:space-x-4">
                    <a href="dashboard.html" class="nav-link active" aria-current="page">Live Threats</a>
                    <a href="simulations.html" class="nav-link">Simulations</a>
                    <a href="#" class="nav-link nav-link-disabled" title="Coming Soon" aria-disabled="true">Research</a>
                    <button id="logoutButton" type="button" class="logout-button ml-4">
                        Log Out
                    </button>
                </div>

                {/* Mobile Menu Button (Placeholder - Needs JS for functionality) */}
                <div class="-mr-2 flex items-center sm:hidden">
                    <button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-cyan-300 hover:text-white hover:bg-cyan-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-cyan-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        {/* Icon when menu is closed. Heroicon name: menu */}
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        {/* Icon when menu is open. Heroicon name: x */}
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
        </div>

        {/* Mobile menu, show/hide based on menu state (Placeholder - Needs JS) */}
        <div class="sm:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="dashboard.html" class="block nav-link active" aria-current="page">Live Threats</a>
                <a href="simulations.html" class="block nav-link">Simulations</a>
                <a href="#" class="block nav-link nav-link-disabled" aria-disabled="true">Research</a>
                 <button id="logoutButtonMobile" type="button" class="block w-full text-left logout-button mt-2 px-3 py-2">
                     Log Out
                 </button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10">
        <h1 class="text-3xl md:text-4xl font-bold neon-text mb-8">Live Threat Dashboard</h1>

        <section id="liveStats" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-10">
            {/* Card 1: Threats Detected */}
            <div class="card text-center">
                <h3 class="stat-label">Threats Blocked (24h)</h3>
                <p id="threatsDetected" class="stat-number">0</p>
            </div>
            {/* Card 2: Phishing Campaigns */}
            <div class="card text-center">
                <h3 class="stat-label">Active Phishing Ops</h3>
                <p id="phishingCampaigns" class="stat-number">0</p>
            </div>
            {/* Card 3: Deepfakes Intercepted */}
             <div class="card text-center">
                <h3 class="stat-label">Deepfakes Neutralized</h3>
                <p id="deepfakesIntercepted" class="stat-number">0</p>
            </div>
            {/* Card 4: Networks Secured */}
            <div class="card text-center">
                <h3 class="stat-label">Secure Endpoints</h3>
                <p id="networksSecured" class="stat-number">0</p>
            </div>
        </section>

        <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            {/* Column 1 & 2: Recent Scam Types Chart */}
            <div class="lg:col-span-2 card">
                <h3 class="text-xl font-bold text-cyan-300 mb-4">AI-Driven Attack Vectors (Simulated)</h3>
                {/* Container div with explicit height for Chart.js */}
                <div class="chart-container">
                     <canvas id="scamChart"></canvas>
                </div>
            </div>

            {/* Column 3: Top Phishing Websites List */}
            <div class="lg:col-span-1 card flex flex-col"> {/* Flex column for better height management */}
                 <h3 class="text-xl font-bold text-cyan-300 mb-4 flex-shrink-0">High-Risk AI Phishing URLs</h3>
                 {/* Scrollable List Container */}
                <div class="list-container flex-grow">
                    <ul id="phishingList" class="space-y-2">
                        {/* Placeholder item */}
                        <li class="list-item text-gray-500 opacity-75">Initializing threat feed...</li>
                        {/* List items will be populated by JS */}
                    </ul>
                </div>
            </div>

        </section>

    </main>

    <script src="js/data.js" defer></script>
    <script src="js/auth.js" defer></script>
    <script src="js/charts.js" defer></script>
    <script src="js/script.js" defer></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM fully loaded and parsed for dashboard.html");

            // --- Authentication Check ---
            // Redirect to index.html if the user is not logged in
            if (typeof isLoggedIn !== 'function' || !isLoggedIn()) {
                console.warn("User not logged in or isLoggedIn function missing. Redirecting to login.");
                window.location.href = 'index.html';
                return; // Stop script execution for this page
            } else {
                 console.log("User is logged in:", getCurrentUser());
            }

            // --- Initialize Background ---
            if (typeof initMatrixBackground === 'function') {
                initMatrixBackground('matrixCanvas');
            } else {
                 console.error("initMatrixBackground function not found.");
            }

            // --- Initialize Dashboard Specific Components ---
            console.log("Initializing dashboard components...");
            if (typeof initLiveStatsCounters === 'function') {
                initLiveStatsCounters(); // Start the stat counters from script.js
            } else {
                console.error("initLiveStatsCounters function not found.");
            }

            if (typeof renderScamChart === 'function') {
                renderScamChart('scamChart'); // Render the chart from charts.js
            } else {
                 console.error("renderScamChart function not found.");
            }

            if (typeof populatePhishingList === 'function') {
                populatePhishingList('phishingList'); // Fill the phishing list from script.js
            } else {
                console.error("populatePhishingList function not found.");
            }


            // --- Logout Button Functionality ---
            const logoutHandler = () => {
                 if(typeof signOut === 'function') {
                    console.log("Signing out...");
                    signOut();
                    window.location.href = 'index.html'; // Redirect after sign out
                 } else {
                    console.error("signOut function not found.");
                    alert("Error logging out.");
                 }
            };

            const logoutButton = document.getElementById('logoutButton');
            if (logoutButton) {
                logoutButton.addEventListener('click', logoutHandler);
            } else {
                console.error("Logout button not found.");
            }

            // Add listener for mobile logout button as well
            const logoutButtonMobile = document.getElementById('logoutButtonMobile');
             if (logoutButtonMobile) {
                 logoutButtonMobile.addEventListener('click', logoutHandler);
             } else {
                 console.warn("Mobile logout button not found."); // Less critical if mobile menu isn't implemented yet
             }

             // --- Mobile Menu Toggle (Basic Placeholder) ---
             // A full implementation requires more robust state management
             const menuButton = document.querySelector('button[aria-controls="mobile-menu"]');
             const mobileMenu = document.getElementById('mobile-menu');
             if(menuButton && mobileMenu) {
                menuButton.addEventListener('click', () => {
                    const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
                    menuButton.setAttribute('aria-expanded', !isExpanded);
                    mobileMenu.classList.toggle('hidden');
                     // Toggle icons (optional)
                     menuButton.querySelectorAll('svg').forEach(icon => icon.classList.toggle('hidden'));
                });
             }

        });
    </script>

</body>
</html>
