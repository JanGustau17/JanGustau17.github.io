<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GustauShield - Dashboard</title>

    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        /* Base styles */
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Poppins', sans-serif; /* Default to Poppins */
            background-color: #000000;
            color: #00ffcc; /* Neon Teal */
            padding-top: 70px; /* Adjust based on nav height */
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        /* Use Orbitron for headings via class */
        .font-orbitron { font-family: 'Orbitron', sans-serif; }

        /* Matrix Background */
        .matrix-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .matrix-canvas { display: block; width: 100%; height: 100%; }

        /* Neon Text Effect */
        .neon-text { color: #ffffff; text-shadow: 0 0 5px rgba(0, 255, 204, 0.8), 0 0 10px rgba(0, 255, 204, 0.8), 0 0 15px rgba(0, 255, 204, 0.7); }

        /* Navigation Styling */
        .navbar { background-color: rgba(0, 5, 5, 0.8); border-bottom: 1px solid #007a7a; backdrop-filter: blur(8px); box-shadow: 0 4px 20px rgba(0, 255, 204, 0.1); z-index: 50; }
        .nav-link { color: #00ffcc; font-size: 0.9rem; font-weight: 500; padding: 0.6rem 1rem; border-radius: 4px; border: 1px solid transparent; transition: all 0.25s ease-in-out; text-transform: uppercase; letter-spacing: 0.05em; }
        .nav-link:hover { color: #ffffff; background-color: rgba(0, 255, 204, 0.15); border-color: rgba(0, 255, 204, 0.3); text-shadow: 0 0 8px rgba(0, 255, 204, 0.5); }
        .nav-link.active { color: #000000; background-color: #00ffcc; border-color: #00ffcc; font-weight: 700; text-shadow: none; box-shadow: 0 0 12px rgba(0, 255, 204, 0.6); }
        .nav-link-disabled { color: #007a7a; cursor: not-allowed; opacity: 0.6; }
        .nav-link-disabled:hover { background-color: transparent; border-color: transparent; text-shadow: none; }
        .logout-button { background-color: rgba(255, 77, 77, 0.2); border: 1px solid #ff4d4d; color: #ff9999; font-size: 0.8rem; padding: 0.5rem 0.9rem; border-radius: 4px; font-weight: bold; transition: all 0.25s ease; text-transform: uppercase; }
        .logout-button:hover { background-color: #ff4d4d; color: #ffffff; box-shadow: 0 0 10px rgba(255, 77, 77, 0.7); }

        /* Dashboard Card Styling */
        .card { background-color: rgba(0, 20, 20, 0.75); border: 1px solid #005050; backdrop-filter: blur(4px); padding: 1.5rem; border-radius: 6px; box-shadow: 0 0 15px rgba(0, 255, 204, 0.1); margin-bottom: 1.5rem; }

        /* Live Stat Styling */
        .stat-number { font-size: 2.2rem; font-weight: 700; color: #ffffff; line-height: 1.2; text-shadow: 0 0 6px rgba(0, 255, 204, 0.6); transition: color 0.3s ease; }
        .stat-label { font-size: 0.9rem; color: #80ffff; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em; }

        /* Phishing List Styling */
        .list-item { background-color: rgba(0, 40, 40, 0.4); padding: 0.75rem 1rem; border-radius: 4px; margin-bottom: 0.5rem; border-left: 4px solid #00ffcc; font-size: 0.85rem; color: #cceeee; transition: background-color 0.2s ease, border-color 0.2s ease; word-break: break-all; }
        .list-item:hover { background-color: rgba(0, 60, 60, 0.6); border-left-color: #ffffff; color: #ffffff; }
        .list-container { max-height: 320px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: #00ffcc rgba(0, 40, 40, 0.4); }
        .list-container::-webkit-scrollbar { width: 6px; }
        .list-container::-webkit-scrollbar-track { background: rgba(0, 40, 40, 0.2); border-radius: 3px; }
        .list-container::-webkit-scrollbar-thumb { background-color: #00ffcc; border-radius: 3px; border: 1px solid rgba(0, 40, 40, 0.2); }
        .list-container::-webkit-scrollbar-thumb:hover { background-color: #ffffff; }

        /* Chart Container */
        .chart-container { position: relative; height: 350px; width: 100%; }
    </style>
</head>
<body class="antialiased font-poppins">

    <div class="matrix-bg">
        <canvas id="matrixCanvas" class="matrix-canvas"></canvas>
    </div>

    <nav class="navbar fixed top-0 left-0 right-0">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0 flex items-center">
                    <a href="dashboard.html" class="text-2xl font-bold neon-text font-orbitron hover:opacity-80 transition-opacity duration-200">
                        GustauShield
                    </a>
                </div>
                <div class="hidden sm:ml-6 sm:flex sm:items-center sm:space-x-4">
                    <a href="dashboard.html" class="nav-link active" aria-current="page">Live Threats</a>
                    <a href="simulations.html" class="nav-link">Simulations</a>
                    <a href="#" class="nav-link nav-link-disabled" title="Coming Soon" aria-disabled="true">Research</a>
                    <button id="logoutButton" type="button" class="logout-button ml-4">
                        Log Out
                    </button>
                </div>
                 <div class="-mr-2 flex items-center sm:hidden">
                    <button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-cyan-300 hover:text-white hover:bg-cyan-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-cyan-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="sm:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="dashboard.html" class="block nav-link active" aria-current="page">Live Threats</a>
                <a href="simulations.html" class="block nav-link">Simulations</a>
                <a href="#" class="block nav-link nav-link-disabled" aria-disabled="true">Research</a>
                 <button id="logoutButtonMobile" type="button" class="block w-full text-left logout-button mt-2 px-3 py-2">
                     Log Out
                 </button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10">
        <h1 class="text-3xl md:text-4xl font-bold neon-text font-orbitron mb-8">Live Threat Dashboard</h1>

        {/* Live Threat Statistics Grid */}
        <section id="liveStats" aria-labelledby="stats-heading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-10">
             <h2 id="stats-heading" class="sr-only">Live Threat Statistics</h2> {/* Heading for screen readers */}
            <div class="card text-center">
                <h3 class="stat-label font-orbitron">Threats Blocked (24h)</h3>
                <p id="threatsDetected" class="stat-number font-orbitron">0</p>
            </div>
            <div class="card text-center">
                <h3 class="stat-label font-orbitron">Active Phishing Ops</h3>
                <p id="phishingCampaigns" class="stat-number font-orbitron">0</p>
            </div>
             <div class="card text-center">
                <h3 class="stat-label font-orbitron">Deepfakes Neutralized</h3>
                <p id="deepfakesIntercepted" class="stat-number font-orbitron">0</p>
            </div>
            <div class="card text-center">
                <h3 class="stat-label font-orbitron">Secure Endpoints</h3>
                <p id="networksSecured" class="stat-number font-orbitron">0</p>
            </div>
        </section>

        {/* Charts and Lists Grid */}
        <section aria-labelledby="data-visualization-heading" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <h2 id="data-visualization-heading" class="sr-only">Data Visualizations</h2> {/* Heading for screen readers */}
            {/* Scam Types Chart */}
            <div class="lg:col-span-2 card">
                <h3 class="text-xl font-bold text-cyan-300 mb-4 font-orbitron">AI-Driven Attack Vectors (Simulated)</h3>
                <div class="chart-container">
                     <canvas id="scamChart" role="img" aria-label="Bar chart showing frequency of different AI-driven attack vectors"></canvas>
                </div>
            </div>

            {/* Phishing Websites List */}
            <div class="lg:col-span-1 card flex flex-col">
                 <h3 id="phishing-list-heading" class="text-xl font-bold text-cyan-300 mb-4 flex-shrink-0 font-orbitron">High-Risk AI Phishing URLs</h3>
                <div class="list-container flex-grow">
                    {/* Ensure UL has aria-labelledby if heading isn't directly associated */}
                    <ul id="phishingList" aria-labelledby="phishing-list-heading" class="space-y-2">
                        <li class="list-item text-gray-500 opacity-75 italic">Initializing threat feed...</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    {/* Footer (Optional) */}
    {/*
    <footer class="mt-12 py-6 text-center text-sm text-gray-500 border-t border-gray-800 relative z-10">
        GustauShield &copy; 2025 - AI-Powered Defense System
    </footer>
    */}

    {/* External JavaScript Files (defer ensures they load after HTML parsing but before DOMContentLoaded) */}
    {/* Order can matter if scripts depend on each other (e.g., auth might use data) */}
    <script src="js/data.js" defer></script>
    <script src="js/auth.js" defer></script>
    <script src="js/charts.js" defer></script>
    <script src="js/script.js" defer></script>

    {/* Inline script for initialization logic specific to this page */}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Dashboard Initializing...");

            // --- Section: Authentication Check ---
            console.log("Checking authentication status...");
            // Defensive check: Ensure isLoggedIn function exists before calling
            if (typeof isLoggedIn === 'function') {
                if (!isLoggedIn()) {
                    // If user is not logged in, redirect to the main landing/login page
                    console.warn("User not authenticated. Redirecting to index.html.");
                    window.location.href = 'index.html';
                    return; // IMPORTANT: Stop further execution of this script
                } else {
                    // User is logged in, proceed with initialization
                    const currentUser = typeof getCurrentUser === 'function' ? getCurrentUser() : 'User';
                    console.log(`Authentication successful. User: ${currentUser}`);
                    // You could potentially display the username somewhere if needed
                    // document.getElementById('displayUsername').textContent = currentUser;
                }
            } else {
                // Critical error: Authentication script likely failed to load or is missing
                console.error("CRITICAL: isLoggedIn function not found. Cannot verify authentication. Check auth.js inclusion and integrity.");
                // Optionally, display an error message to the user or redirect
                // document.body.innerHTML = '<h1 style="color: red; text-align: center; margin-top: 50px;">Authentication Error: Please contact support.</h1>';
                alert("Authentication system error. Please try again later or contact support.");
                // Redirecting might be safest if auth state is unknown
                // window.location.href = 'index.html';
                return; // Stop execution
            }

            // --- Section: Initialize Page Components ---
            console.log("Initializing dashboard components...");

            // Initialize Matrix Background
            if (typeof initMatrixBackground === 'function') {
                try {
                    initMatrixBackground('matrixCanvas');
                    console.log("Matrix background initialized successfully.");
                } catch (error) {
                    console.error("Error initializing Matrix background:", error);
                }
            } else {
                console.error("Initialization Error: initMatrixBackground function not found. Check script.js.");
            }

            // Initialize Live Statistics Counters
            if (typeof initLiveStatsCounters === 'function') {
                 try {
                    initLiveStatsCounters();
                    console.log("Live stats counters initialized successfully.");
                } catch (error) {
                    console.error("Error initializing live stats counters:", error);
                }
            } else {
                console.error("Initialization Error: initLiveStatsCounters function not found. Check script.js.");
            }

            // Render Scam Types Chart
            if (typeof renderScamChart === 'function') {
                try {
                    renderScamChart('scamChart'); // Assumes canvas with id="scamChart" exists
                    console.log("Scam chart rendering initiated successfully.");
                } catch (error) {
                     console.error("Error rendering scam chart:", error);
                }
            } else {
                console.error("Initialization Error: renderScamChart function not found. Check charts.js.");
            }

            // Populate Phishing List
            if (typeof populatePhishingList === 'function') {
                 try {
                    populatePhishingList('phishingList'); // Assumes ul with id="phishingList" exists
                    console.log("Phishing list population initiated successfully.");
                 } catch (error) {
                     console.error("Error populating phishing list:", error);
                 }
            } else {
                console.error("Initialization Error: populatePhishingList function not found. Check script.js.");
            }

            // --- Section: Initialize Event Listeners ---
            console.log("Setting up event listeners...");

            // Logout Button Handler
            const logoutHandler = () => {
                console.log("Logout action triggered.");
                if (typeof signOut === 'function') {
                    try {
                        signOut(); // Clear authentication state
                        console.log("User signed out. Redirecting...");
                        window.location.href = 'index.html'; // Redirect to login page
                    } catch (error) {
                         console.error("Error during signOut:", error);
                         alert("An error occurred while logging out.");
                    }
                } else {
                    console.error("Logout Error: signOut function not found. Check auth.js.");
                    alert("Logout function is unavailable.");
                }
            };

            // Attach listener to Desktop Logout Button
            const logoutButton = document.getElementById('logoutButton');
            if (logoutButton) {
                logoutButton.addEventListener('click', logoutHandler);
                console.log("Desktop logout listener attached.");
            } else {
                console.error("Element 'logoutButton' not found.");
            }

            // Attach listener to Mobile Logout Button
            const logoutButtonMobile = document.getElementById('logoutButtonMobile');
             if (logoutButtonMobile) {
                 logoutButtonMobile.addEventListener('click', logoutHandler);
                 console.log("Mobile logout listener attached.");
             } else {
                 // This might be expected if mobile view isn't primary target
                 console.warn("Element 'logoutButtonMobile' not found.");
             }

             // Mobile Menu Toggle Handler
             const menuButton = document.querySelector('button[aria-controls="mobile-menu"]');
             const mobileMenu = document.getElementById('mobile-menu');
             const mobileMenuIcons = menuButton ? menuButton.querySelectorAll('svg') : [];

             if (menuButton && mobileMenu && mobileMenuIcons.length === 2) {
                menuButton.addEventListener('click', () => {
                    const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
                    menuButton.setAttribute('aria-expanded', String(!isExpanded));
                    mobileMenu.classList.toggle('hidden');
                    mobileMenuIcons[0].classList.toggle('hidden');
                    mobileMenuIcons[1].classList.toggle('hidden');
                    console.log(`Mobile menu toggled: ${!isExpanded ? 'Open' : 'Closed'}`);
                });
                console.log("Mobile menu listener attached.");
             } else {
                 console.warn("Mobile menu elements (button, panel, or icons) incomplete or not found.");
             }

            console.log("Dashboard initialization complete.");

        }); // End of DOMContentLoaded listener
    </script>

</body>
</html>
